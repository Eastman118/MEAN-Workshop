<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Day 2 - Express.js</title>

  <meta name="description" content="Welcome to the M.E.A.N. Workshop">
  <meta name="author" content="Arvind Ravulavaru">

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="css/reveal.min.css">
  <link rel="stylesheet" href="css/theme/serif.css" id="theme">

  <!-- For syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- If the query includes 'print-pdf', include the PDF print sheet -->
  <script>
  if (window.location.search.match(/print-pdf/gi)) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = 'css/print/pdf.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  }
  </script>

  <!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->

  <base target="_blank">
</head>

<body>

  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
      <section>
        <h1>Day 2 Express.js</h1>
        <br/>
        <br/>
        <h3 style="width:100%;">Web application framework for Node.js</h3>
        <br/>
        <br/>
        <h3>
          <small><a href="http://mean-workshop.herokuapp.com/">Workshop Home Page</a>
          </small>
        </h3>
      </section>

      <section>
        <h2>What is Express.js?</h2>
        <hr/>
        <br/>
        <ul>
          <li>Node.js based web framework</li>
          <li>Inspired by Sinatra</li>
          <li>Serverside MVC framework</li>
        </ul>
      </section>

      <section>
        <h2>What Express.js does?</h2>
        <hr/>
        <br/>
        <ul>
          <li>Parsing the Request object</li>
          <li>Manage Routing</li>
          <li>Templating</li>
          <li>Sessions</li>
        </ul>
      </section>

      <section>
        <h2>Hands on</h2>
      </section>

      <section>
        <h2>Sample Express.js App</h2>
        <hr/>
        <br/>
        <div style="text-align:left;">
          <h4>Step 1 :
            <code>npm init</code>
          </h4>
          <h4>Step 2 :
            <code>npm install --save express</code>
          </h4>
          <h4>Step 3 :
            <code>Write Express code</code>
          </h4>
          <h4>Step 4 :
            <code>nodemon app.js</code>
          </h4>
          <h4>Step 5 :
            <code>http://localhost:3000</code>
          </h4>
        </div>
      </section>
      <section>
        <h2>Sample Express.js App</h2>
        <hr/>
        <br/>
        <h4>
          <pre><code>$ npm init</code></pre>
        </h4>
        <pre><code>{
  "name": "sampleApp",
  "version": "0.1.0",
  "description": "A Sample Express.js App",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Arvind Ravulavaru",
  "license": "MIT"
}
</code></pre>

      </section>
      <section>
        <h2>Sample Express.js App
          <small>cont...</small>
        </h2>
        <hr/>
        <br/>
        <h4>
          <pre><code>$ npm install --save express</code></pre>
        </h4>
        <pre><code>{
  "name": "sampleApp",
  "version": "0.1.0",
  "description": "A Sample Express.js App",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Arvind Ravulavaru",
  "license": "MIT",
  "dependencies": {
    "express": "^4.8.7"
  }
}</code></pre>

      </section>
      <section>
        <h2>Sample Express.js App
          <small>cont...</small>
        </h2>
        <hr/>
        <br/>
        <h4>
          <pre><code>$ touch app.js</code></pre>
        </h4>
        <pre><code>var express = require('express');
var app = express();

app.get('/', function(req, res) {
  res.send('<a href="/hello">Hello Page</a>');
});

app.get('/hello', function(req, res) {
  res.send('Hello World');
});

var server = app.listen(3000, function() {
  console.log('Listening on port %d', server.address().port);
});</code></pre>

      </section>
      <section>
        <h2>Sample Express.js App
          <small>cont...</small>
        </h2>
        <hr/>
        <br/>
        <h4>
          <pre><code>$ nodemon app.js</code></pre>
        </h4>
        <br/>
        <code>http://localhost:3000</code>
      </section>

      <section>
        <h2>Scaffolding Express Apps</h2>
      </section>

      <section>
        <h2>Installing Express.js</h2>
        <hr/>
        <br/>
        <pre><code>$ [sudo] npm install -g express-generator</code></pre>
        <br/>
        <h4>This will make
          <code>express</code>command global</h4>
      </section>

      <section>
        <h2>Verify setup</h2>
        <hr/>
        <br/>
        <pre><code>$ express -V
> 4.8.0 </code></pre>
      </section>

      <section>
        <h2>Scaffolding</h2>
        <hr/>
        <h4>New Folder
          <code>myApp</code>
        </h4>
        <pre><code>$ express</code></pre>
        <pre><code>create : .
create : ./package.json
create : ./app.js
create : ./public
create : ./public/images
create : ./public/stylesheets
create : ./public/stylesheets/style.css
create : ./routes
create : ./routes/index.js
create : ./routes/users.js
create : ./views
create : ./views/index.jade
create : ./views/layout.jade
create : ./views/error.jade
create : ./bin
create : ./bin/www
create : ./public/javascripts

   install dependencies:
     $ cd . && npm install

   run the app:
     $ DEBUG=myApp ./bin/www</code></pre>

      </section>

      <section>
        <h2>Scaffolding</h2>
        <hr/>
        <pre><code>$ express myApp</code></pre>
        <pre><code>create : myApp
create : myApp/package.json
create : myApp/app.js
create : myApp/public
create : myApp/public/javascripts
create : myApp/public/images
create : myApp/public/stylesheets
create : myApp/public/stylesheets/style.css
create : myApp/routes
create : myApp/routes/index.js
create : myApp/routes/users.js
create : myApp/views
create : myApp/views/index.jade
create : myApp/views/layout.jade
create : myApp/views/error.jade
create : myApp/bin
create : myApp/bin/www

   install dependencies:
     $ cd myApp && npm install

   run the app:
     $ DEBUG=myApp ./bin/www</code></pre>

      </section>
      <section>
        <h2>Project Structure</h2>
        <hr/>
        <pre><code>.
|-- app.js
|-- bin
|   `-- www
|-- package.json
|-- public
|   |-- images
|   |-- javascripts
|   `-- stylesheets
|       `-- style.css
|-- routes
|   |-- index.js
|   `-- users.js
`-- views
    |-- error.jade
    |-- index.jade
    `-- layout.jade</code></pre>
        <pre><code>$ nodemon bin/www </code></pre>
        <code>http://locahost:3000</code>
      </section>
      <section>
        <h2>Power of Templating</h2>
      </section>
      <section>
        <h2>Express options</h2>
        <hr/>
        <br/>
        <pre><code>-e, --ejs           add ejs engine support (defaults to jade)
    --hbs           add handlebars engine support
-H, --hogan         add hogan.js engine support
-c, --css <engine>  add stylesheet <engine> support (less|stylus|compass)
-f, --force         force on non-empty directory</code></pre>
      </section>
      <section>
        <h3>Handlebars Templating with LESS</h3>
        <hr/>
        <pre><code>$ express myApp -e -c less</code></pre>
        <pre><code>create : myApp
create : myApp/package.json
create : myApp/app.js
create : myApp/public
create : myApp/public/images
create : myApp/public/javascripts
create : myApp/public/stylesheets
create : myApp/public/stylesheets/style.less
create : myApp/routes
create : myApp/routes/index.js
create : myApp/routes/users.js
create : myApp/views
create : myApp/views/index.ejs
create : myApp/views/error.ejs
create : myApp/bin
create : myApp/bin/www

   install dependencies:
     $ cd myApp && npm install

   run the app:
     $ DEBUG=myApp ./bin/www
</code></pre>

      </section>

      <section>
        <h3>Handlebars Templating with LESS</h3>
        <hr/>
        <pre><code>.
|-- app.js
|-- bin
|   `-- www
|-- package.json
|-- public
|   |-- images
|   |-- javascripts
|   `-- stylesheets
|       `-- style.less  << LESS
|-- routes
|   |-- index.js
|   `-- users.js
`-- views
    |-- error.ejs   << EJS
    `-- index.ejs   << EJS</code></pre>
      </section>

      <section>
        <h2>Understanding
          <code>app.js</code>
        </h2>
        <hr/>
        <pre><code>//Init an Express.js app
[line 11] var app = express();</code></pre>
        <pre><code>//View engine setup
[line 14] app.set('views', path.join(__dirname, 'views'));
[line 15] app.set('view engine', 'ejs');</code></pre>
        <pre><code>//LESS Middlerware
[line 23] app.use(require('less-middleware')(path.join(__dirname, 'public')));
[line 24] app.use(express.static(path.join(__dirname, 'public')));</code></pre><pre><code>//Routes config
[line 26] app.use('/', routes);
[line 27] app.use('/users', users);</code></pre>
      </section>

      <section>
        <h2>What are Middlewares?
        </h2>

      </section>
      <section>
        <h2>Middlewares
        </h2>
        <hr/>
        <div style="text-align:left;">
          <h3>Anything that is inbetween the raw request and the intended route is a Middleware
          </h3>
          <h3>Invoked in the order they are added to the Middleware stack</h3>
        </div>
      </section>

      <section>
        <h2>Middleware function
        </h2>
        <hr/>
        <pre><code>app.use(function(err, req, res, next){
  // do stuff here
});</code></pre>
        <ul>
          <li>
            <code>err</code>- Error object from previous middleware function</li>
          <li>
            <code>req</code>- Request object</li>
          <li>
            <code>res</code>- Response object</li>
          <li>
            <code>next</code>- Trigger next Middlerware</li>

      </section>
      <section>
        <h2>Sample Middleware
        </h2>
        <hr/>
        <h4>Add before the routes in
          <code>app.js</code>
        </h4>
        <pre><code>app.use(function(req, res, next) {
    console.log('Request Method [%s]  Request URL [%s]', req.method, req.url);
    next();
});</code></pre>
        <code>http://localhost:3000</code>
        <pre><code>[nodemon] v1.0.17
[nodemon] to restart at any time, enter `rs`
[nodemon] watching: *.*
[nodemon] starting `node bin/www`
Request Method [GET]  Request URL [/]
GET / 304 13.876 ms - -
GET /stylesheets/style.css 200 22.963 ms - 87</code></pre>
      </section>
      <section>
        <h2>Realtime use cases of Middleware
        </h2>
      </section>

      <section>
        <h2>
          <code>compression</code>
        </h2>
        <hr/>
        <pre><code>$ npm install compression --save</code></pre>
        <h4>require
          <code>compression</code>
        </h4>
        <pre><code>var compression = require('compression');</code></pre>
        <h4>Call it</h4>
        <pre><code>app.use(compression({
  threshold: 1 //min size should be 1kb to compress
}));</code></pre>

      </section>

       <section>
        <h2>
          <code>csrf</code>
        </h2>
        <hr/>
        <pre><code>npm install express-session csurf --save</code></pre><pre><code>var csurf = require('csurf');
var session = require('express-session');</code></pre><pre><code>router.get('/', function(req, res) {
    res.render('index', {
      title: 'Express',
      csrf: req.csrfToken()
    });
  });</code></pre><pre><code>Token => <%= csrf %></code></pre>
        </section>

      <section>
        <h2>Thanks!
        </h2>
        <hr/>
        <h3>Next up
          <code>MongoDB</code>
        </h3>
      </section>

    </div>

  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.min.js"></script>

  <script>
  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
    transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

    // Parallax scrolling
    // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
    // parallaxBackgroundSize: '2100px 900px',

    // Optional libraries used to extend on reveal.js
    dependencies: [{
      src: 'lib/js/classList.js',
      condition: function() {
        return !document.body.classList;
      }
    }, {
      src: 'plugin/markdown/marked.js',
      condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
    }, {
      src: 'plugin/markdown/markdown.js',
      condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
    }, {
      src: 'plugin/highlight/highlight.js',
      async: true,
      callback: function() {
        hljs.initHighlightingOnLoad();
      }
    }, {
      src: 'plugin/zoom-js/zoom.js',
      async: true,
      condition: function() {
        return !!document.body.classList;
      }
    }, {
      src: 'plugin/notes/notes.js',
      async: true,
      condition: function() {
        return !!document.body.classList;
      }
    }]
  });
  </script>

</body>

</html>
